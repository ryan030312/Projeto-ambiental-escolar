<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>A Vida de Ryan - 35 Perguntas sobre Poluição (Final)</title>
<style>
  :root{--bg:#e8f7fb;--card:#fff;--accent:#00796b;--ok:#2e7d32;--bad:#c62828;--neutral:#00695c}
  body{
    margin:0;
    min-height:100vh;
    display:flex;
    align-items:center;
    justify-content:center;
    background:linear-gradient(180deg,var(--bg),#dff3f2);
    font-family:Inter, system-ui, Arial, sans-serif;
  }
  #game{
    width:95%;
    max-width:760px;
    background:var(--card);
    border-radius:12px;
    padding:18px;
    box-shadow:0 8px 30px rgba(0,0,0,0.12);
    text-align:center;
    position:relative;
    overflow:visible;
  }
  h1{margin:6px 0 12px;font-size:22px;color:var(--accent)}
  #meta{display:flex;gap:12px;flex-wrap:wrap;justify-content:center;margin-bottom:10px}
  .panel{background:#f7fffd;padding:8px 12px;border-radius:8px;border:1px solid rgba(0,0,0,0.04);font-weight:600}
  #question{min-height:68px;padding:10px 6px;font-size:18px}
  #choices{display:flex;flex-direction:column;gap:10px;align-items:center;margin-top:6px}
  .btn{
    min-width:220px;
    width:80%;
    max-width:420px;
    padding:12px 14px;
    font-size:16px;
    border-radius:10px;
    border:0;
    cursor:pointer;
    box-shadow:0 4px 12px rgba(0,0,0,0.06);
    background:#f1f8f7;
    transition:transform .08s ease,box-shadow .08s;
  }
  .btn:hover{transform:translateY(-3px);box-shadow:0 8px 20px rgba(0,0,0,0.08)}
  .btn:active{transform:translateY(0)}
  #continue{padding:10px 14px; border-radius:10px; background:#1976d2;color:#fff;border:0;cursor:pointer;margin-top:8px}
  #overlayCanvas{position:absolute;left:0;top:0;width:100%;height:100%;pointer-events:none;z-index:6}
  /* X / neutral animation */
  #xEffect{
    position:absolute;
    left:50%;
    top:50%;
    transform:translate(-50%,-140%);
    font-size:86px;
    color:var(--bad);
    display:none;
    z-index:7;
    text-shadow:0 6px 18px rgba(0,0,0,0.12);
    animation:pop 700ms ease-out;
  }
  @keyframes pop{0%{transform:translate(-50%,-140%) scale(.2) rotate(-15deg);opacity:0}50%{opacity:1;transform:translate(-50%,-140%) scale(1.08) rotate(5deg)}100%{transform:translate(-50%,-140%) scale(1) rotate(0)}}
  footer{margin-top:12px;font-size:13px;color:#456;opacity:.95}
  #scoreBreak{font-size:13px;margin-top:6px;color:#333}
  @media(min-width:640px){
    #choices{flex-direction:row;flex-wrap:wrap;justify-content:center}
    .btn{width:auto}
  }
</style>
</head>
<body>
  <div id="game">
    <canvas id="overlayCanvas"></canvas>
    <div id="xEffect">❌</div>

    <h1>A Vida de Ryan — Proteja os Rios (35)</h1>

    <div id="meta">
      <div class="panel" id="scoreBoard">Pontuação: 0</div>
      <div class="panel" id="remaining">Questões restantes: 35</div>
      <div class="panel" id="currentScene">Questão: 0 / 35</div>
    </div>

    <div id="question">Clique em "Começar" para iniciar o jogo!</div>

    <div id="choices">
      <button class="btn" id="startBtn">Começar</button>
    </div>

    <div id="scoreBreak"></div>
    <footer>Foque em atitudes que reduzem lixo e protegem rios e córregos.</footer>
  </div>

<script>
/* ====== SONS por WebAudio (sem arquivos externos) ====== */
const AudioCtx = (window.AudioContext||window.webkitAudioContext);
let audioCtx = null;
function ensureAudio() { if(!audioCtx) audioCtx = new AudioCtx(); }

/* som de acerto: pequena sequência ascendente */
function playCorrectSound(){
  ensureAudio();
  const now = audioCtx.currentTime;
  const o1 = audioCtx.createOscillator();
  const o2 = audioCtx.createOscillator();
  const g = audioCtx.createGain();
  o1.type = 'sine'; o2.type = 'triangle';
  o1.frequency.setValueAtTime(520, now);
  o2.frequency.setValueAtTime(720, now);
  o1.frequency.linearRampToValueAtTime(780, now + 0.20);
  o2.frequency.linearRampToValueAtTime(980, now + 0.20);
  g.gain.setValueAtTime(0, now);
  g.gain.linearRampToValueAtTime(0.18, now + 0.01);
  g.gain.linearRampToValueAtTime(0.001, now + 0.28);
  o1.connect(g); o2.connect(g); g.connect(audioCtx.destination);
  o1.start(now); o2.start(now);
  o1.stop(now + 0.3); o2.stop(now + 0.3);
}

/* som de erro: curto ruído descendente */
function playWrongSound(){
  ensureAudio();
  const now = audioCtx.currentTime;
  const o = audioCtx.createOscillator();
  const g = audioCtx.createGain();
  o.type = 'sawtooth';
  o.frequency.setValueAtTime(260, now);
  o.frequency.exponentialRampToValueAtTime(80, now + 0.22);
  g.gain.setValueAtTime(0, now);
  g.gain.linearRampToValueAtTime(0.22, now + 0.01);
  g.gain.exponentialRampToValueAtTime(0.001, now + 0.28);
  o.connect(g); g.connect(audioCtx.destination);
  o.start(now); o.stop(now + 0.28);
}

/* som neutro (meia-certa): pequeno 'plim' suave */
function playNeutralSound(){
  ensureAudio();
  const now = audioCtx.currentTime;
  const o = audioCtx.createOscillator();
  const g = audioCtx.createGain();
  o.type = 'sine';
  o.frequency.setValueAtTime(660, now);
  o.frequency.exponentialRampToValueAtTime(840, now + 0.12);
  g.gain.setValueAtTime(0, now);
  g.gain.linearRampToValueAtTime(0.08, now + 0.005);
  g.gain.exponentialRampToValueAtTime(0.001, now + 0.18);
  o.connect(g); g.connect(audioCtx.destination);
  o.start(now); o.stop(now + 0.2);
}

/* ====== PARTICLES / FIREWORKS (Canvas) ====== */
const canvas = document.getElementById('overlayCanvas');
const ctx = canvas.getContext('2d');
const game = document.getElementById('game');
function resizeCanvas(){ canvas.width = game.clientWidth; canvas.height = game.clientHeight; }
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

let particles = [];
function spawnFireworks(x,y, color){
  for(let i=0;i<40;i++){
    particles.push({
      x: x + (Math.random()-0.5)*80,
      y: y + (Math.random()-0.5)*40,
      vx:(Math.random()-0.5)*6,
      vy:(Math.random()-1.5)*6,
      life:60 + Math.random()*40,
      r:1 + Math.random()*3,
      col: color
    });
  }
}
function stepParticles(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  for(let i=particles.length-1;i>=0;i--){
    const p = particles[i];
    p.vy += 0.12;
    p.x += p.vx; p.y += p.vy;
    p.life--;
    const alpha = Math.max(0, p.life/100);
    ctx.beginPath();
    ctx.fillStyle = `rgba(${p.col.r},${p.col.g},${p.col.b},${alpha})`;
    ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
    ctx.fill();
    if(p.life<=0) particles.splice(i,1);
  }
  requestAnimationFrame(stepParticles);
}
stepParticles();

function randomColorRGB(){
  const palette = [
    {r:255,g:80,b:80},{r:255,g:190,b:60},{r:60,g:180,b:120},
    {r:80,g:150,b:255},{r:180,g:80,b:255},{r:255,g:120,b:180}
  ];
  return palette[Math.floor(Math.random()*palette.length)];
}

/* ====== JOGO: 35 perguntas sobre poluição (rios, lixo, descarte) ====== */
let sceneIndex = 0;
let scores = {env:0,eth:0,resp:0};

/* Perguntas (cada uma tem 3 opções). Valores originais mantidos, mas o jogo NORMALIZA a resposta:
   >0 => correta (+1), 0 => neutra (0), <0 => errada (-1)
   (Isso permite manter mensagens originais e usar a nova regra sem reescrever todo o array.)
*/
const questions = [
  {q:"Você acabou de comer um doce no carro. Joga o papel de bala pela janela?", opts:[
    {t:"Jogo pela janela", type:"env", score:-1, msg:"O papel pode ser levado pela chuva aos rios."},
    {t:"Guardo e jogo no lixo depois", type:"env", score:2, msg:"Boa! Jogar no lixo evita poluição nos rios."},
    {t:"Coloco na mochila para descartar depois", type:"env", score:1, msg:"Ótimo — guardar e descartar corretamente é útil."}
  ]},
  {q:"Vê uma garrafa plástica no chão, próxima a um córrego. O que faz?", opts:[
    {t:"Ignoro", type:"env", score:-1, msg:"A garrafa pode acabar no córrego e prejudicar animais."},
    {t:"Pego e jogo em uma lixeira", type:"env", score:2, msg:"Excelente — evita que o lixo entre no córrego."},
    {t:"Levo para reciclagem em casa", type:"env", score:2, msg:"Ótimo: reciclar é a melhor opção quando possível."}
  ]},
  {q:"Percebe lixo próximo a um bueiro que pode entupir. O que faz?", opts:[
    {t:"Ignoro", type:"env", score:-1, msg:"Bueiros entupidos agravam enchentes e levam lixo aos rios."},
    {t:"Registro com foto e denuncio à prefeitura", type:"env", score:1, msg:"Denunciar facilita a limpeza oficial."},
    {t:"Se for seguro, removo o lixo ou chamo vizinhos para mutirão", type:"env", score:2, msg:"Ação comunitária ajuda muito a prevenir enchentes."}
  ]},
  {q:"Está em um passeio e tem um saquinho com lixo. O que faz?", opts:[
    {t:"Jogo no chão se não houver lixeira visível", type:"env", score:-1, msg:"Lixo no chão acaba chegando aos rios."},
    {t:"Guardo até encontrar uma lixeira", type:"env", score:2, msg:"Muito bem — carregar até o descarte correto é responsável."},
    {t:"Procuro lixeira próxima e separo recicláveis", type:"env", score:2, msg:"Separar recicláveis ajuda o meio ambiente."}
  ]},
  {q:"Seu vizinho despeja óleo de fritura na rua. Você…", opts:[
    {t:"Não faço nada", type:"env", score:-2, msg:"Óleo polui o solo e pode alcançar rios."},
    {t:"Digo que isso prejudica o meio ambiente e encaminho orientação", type:"env", score:2, msg:"Educar é importante e ajuda a mudar comportamento."},
    {t:"Registro e notifico o serviço público que trata resíduos", type:"env", score:1, msg:"Denúncias ajudam na fiscalização."}
  ]},
  {q:"Em festa na rua, as pessoas jogam copos e embalagens. Você…", opts:[
    {t:"Jogo junto para não ser excluído", type:"env", score:-1, msg:"Acompanhando, o lixo se espalha e pode ir aos rios."},
    {t:"Recolho o que posso e separo para reciclar", type:"env", score:2, msg:"Ótimo — atitudes práticas reduz a poluição."},
    {t:"Convido amigos a ajudar a limpar", type:"env", score:2, msg:"Mobilizar o grupo aumenta o impacto positivo."}
  ]},
  {q:"Recebe folhetos/descartáveis em evento. O que faz com os que não quer?", opts:[
    {t:"Jogo no chão", type:"env", score:-1, msg:"Folhetos no chão viram lixo urbano."},
    {t:"Reutilizo como rascunho ou levo para reciclar", type:"env", score:1, msg:"Reusar diminui o que vira lixo."},
    {t:"Recuso folhetos desnecessários na origem", type:"env", score:2, msg:"Evitar na origem reduz muito o desperdício."}
  ]},
  {q:"Vê alguém jogando bituca de cigarro no chão perto do córrego. O que faz?", opts:[
    {t:"Ignoro", type:"env", score:-1, msg:"Bitucas contaminam a água e prejudicam fauna."},
    {t:"Explico que é poluente e peço para jogar no lixo", type:"env", score:2, msg:"Educar pode evitar o problema."},
    {t:"Recolho a bituca com cuidado e a descarto em lixeira", type:"env", score:2, msg:"Recolher ajuda a limpar e evita que chegue ao rio."}
  ]},
  {q:"Vê uma lona/plástico solto próximo a um córrego (vai voar com o vento). O que faz?", opts:[
    {t:"Deixo lá", type:"env", score:-1, msg:"Plásticos soltos acabam no curso d'água."},
    {t:"Fixar ou recolher e descartar", type:"env", score:2, msg:"Boa ação: evita que o plástico vá para o rio."},
    {t:"Aviso alguém responsável para recolher de forma segura", type:"env", score:1, msg:"Avisar a equipe local é útil."}
  ]},
  {q:"Vai ao mercado e precisa escolher entre produto com muita embalagem ou sem. Você…", opts:[
    {t:"Escolho o com mais embalagem", type:"env", score:-1, msg:"Mais embalagem significa mais lixo eventual no rio."},
    {t:"Escolho opções sem embalagem ou a granel", type:"env", score:2, msg:"Reduzir embalagens diminui lixo urbano."},
    {t:"Prefiro embalagem retornável", type:"env", score:1, msg:"Embalagens retornáveis são uma boa opção."}
  ]},
  {q:"Encontra um saco de lixo rasgado perto do córrego. O que faz?", opts:[
    {t:"Passo direto", type:"env", score:-1, msg:"O conteúdo pode ser levado pela chuva para o rio."},
    {t:"Recolho com cuidado e coloco em novo saco", type:"env", score:2, msg:"Ação direta previne que o lixo alcance o córrego."},
    {t:"Registro e aviso o serviço de limpeza pública", type:"env", score:1, msg:"Denunciar ajuda com coleta adequada."}
  ]},
  {q:"Você vê uma placa pública sobre descarte correto mas ninguém segue. Você…", opts:[
    {t:"Acho que não adianta e ignoro", type:"resp", score:-1, msg:"Sem ações, a situação não muda."},
    {t:"Compartilho nas redes para aumentar alcance", type:"resp", score:2, msg:"Divulgar incentiva mais pessoas a seguir."},
    {t:"Convido vizinhos para campanha local", type:"resp", score:2, msg:"Mobilização local gera resultados reais."}
  ]},
  {q:"Em casa, onde descartar pilhas e baterias?", opts:[
    {t:"Jogo no lixo comum", type:"env", score:-2, msg:"Pilhas contaminam solo e água se descartadas incorretamente."},
    {t:"Levo a ponto de coleta adequado", type:"env", score:2, msg:"Ponto de coleta evita contaminação dos rios."},
    {t:"Procuro campanhas de recolhimento em escola/loja", type:"env", score:1, msg:"Boa prática: buscar pontos de recolhimento."}
  ]},
  {q:"Ao viajar de carro, a carga do caminhão não está coberta e papel/embalagens voam. Você…", opts:[
    {t:"Não aviso nada", type:"env", score:-1, msg:"Carga solta gera muito lixo nas vias e rios."},
    {t:"Aviso ao motorista ou à polícia rodoviária", type:"env", score:2, msg:"Avisar evita que o lixo seja espalhado."},
    {t:"Registo e encaminho denúncia ao órgão competente", type:"env", score:1, msg:"Registrar facilita ações futuras."}
  ]},
  {q:"Vê alguém descartando restos de tinta ou solvente na rua. Você…", opts:[
    {t:"Não me meto", type:"env", score:-2, msg:"Químicos podem contaminar o curso d'água."},
    {t:"Informo os riscos e indico descarte correto", type:"env", score:2, msg:"Prevenir uso indevido de produtos químicos protege a água."},
    {t:"Denuncio para órgão ambiental", type:"env", score:1, msg:"Denúncias auxiliam fiscalização."}
  ]},
  {q:"Há um ponto de encontro com muitas embalagens (lixo acumulado). Você…", opts:[
    {t:"Tomo distância e nada faço", type:"env", score:-1, msg:"Pontos fixos de lixo atraem mais lixo e vão ao rio."},
    {t:"Participo de mutirão de limpeza local", type:"env", score:2, msg:"Mutirões reduzem poluição de forma rápida."},
    {t:"Divulgo para prefeitura e vizinhança organizarem limpeza", type:"env", score:1, msg:"Mobilizar autoridades ajuda."}
  ]},
  {q:"Seu familiar sugere queimar lixo em quintal. Você…", opts:[
    {t:"Queimo para reduzir volume", type:"env", score:-2, msg:"Queimar libera poluentes e não resolve o problema do rio."},
    {t:"Explico os danos e procuro alternativa", type:"env", score:2, msg:"Buscar alternativas evita poluição do ar e lixo no rio."},
    {t:"Ajudo a separar recicláveis e encaminhar corretamente", type:"env", score:1, msg:"Separar é uma boa ação prática."}
  ]},
  {q:"Em pescaria, encontra nylon/linha e isca no rio. O que faz?", opts:[
    {t:"Deixo, não é minha responsabilidade", type:"env", score:-1, msg:"Materiais de pesca machucam peixes e aves."},
    {t:"Recolho com cuidado e descarto", type:"env", score:2, msg:"Recolher protege a fauna e a água."},
    {t:"Aviso outros pescadores sobre práticas seguras", type:"env", score:1, msg:"Educar previne novos descartes."}
  ]},
  {q:"Vê lixo boiando no rio durante passeio. Você…", opts:[
    {t:"Tiro foto e sigo sem agir", type:"resp", score:0, msg:"Foto ajuda se for reportada, mas ação direta é melhor."},
    {t:"Recolho quando possível em segurança", type:"env", score:2, msg:"Recolher evita que o lixo siga rio abaixo."},
    {t:"Denuncio e incentivo campanha local", type:"resp", score:1, msg:"Denunciar e mobilizar aumenta solução."}
  ]},
  {q:"Tem opção de usar canudo de plástico ou sem canudo. Você…", opts:[
    {t:"Peço canudo plástico por comodidade", type:"env", score:-1, msg:"Canudos pequenos acabam em rios e oceanos."},
    {t:"Peço sem canudo", type:"env", score:2, msg:"Evitar canudos diminui microplásticos."},
    {t:"Uso canudo reutilizável", type:"env", score:2, msg:"Reutilizáveis são uma ótima opção."}
  ]},
  {q:"No mercado, vê pilhas no corredor sem informação de coleta. Você…", opts:[
    {t:"Compra e joga no lixo comum", type:"env", score:-2, msg:"Pilhas descartadas incorretamente contaminam água."},
    {t:"Pergunto por pontos de devolução", type:"env", score:2, msg:"Buscar informação protege o meio ambiente."},
    {t:"Levo pilhas usadas a ponto de coleta depois", type:"env", score:1, msg:"Guardar até levar ao ponto é válido."}
  ]},
  {q:"Você organiza uma festa no quintal. Como evita lixo indo ao córrego?", opts:[
    {t:"Não me preocupo com descartáveis", type:"env", score:-1, msg:"Descarte descuidado pode acabar no rio."},
    {t:"Disponibilizo lixeiras e separação para reciclagem", type:"env", score:2, msg:"Organizar o descarte evita poluição."},
    {t:"Peço para convidados levarem suas embalagens", type:"env", score:1, msg:"Reduz embalagem e incentivo à responsabilidade."}
  ]},
  {q:"Vê entulho de construção próximo a um curso d'água. Você…", opts:[
    {t:"Ignoro, não é problema meu", type:"env", score:-2, msg:"Entulho causa assoreamento e contaminação."},
    {t:"Registro e denuncio ao órgão competente", type:"env", score:2, msg:"Denúncias levam à remoção e fiscalização."},
    {t:"Organizo grupo para recolher em segurança", type:"env", score:1, msg:"Apoiar limpeza local é muito positivo."}
  ]},
  {q:"Seu colégio propõe projeto de conscientização sobre rios. Você…", opts:[
    {t:"Não participo", type:"eth", score:0, msg:"Perde chance de aprender e mobilizar."},
    {t:"Participo e ajudo a divulgar", type:"eth", score:2, msg:"Projetos educam e mudam hábitos."},
    {t:"Uso o projeto para fazer mutirões", type:"eth", score:2, msg:"Combinar educação e ação é o ideal."}
  ]},
  {q:"Alguém descarta equipamentos eletrônicos perto de uma área verde. Você…", opts:[
    {t:"Ignoro", type:"env", score:-2, msg:"E-lixo libera metais pesados que podem atingir a água."},
    {t:"Procuro ponto de descarte correto e informo o responsável", type:"env", score:2, msg:"E-lixo precisa de tratamento especializado."},
    {t:"Registro e divulgo para comunidade não descartar", type:"resp", score:1, msg:"Avisar ajuda prevenir futuros descartes."}
  ]},
  {q:"Percebe óleo/combustível vazando de veículo perto do rio. Você…", opts:[
    {t:"Passo adiante", type:"env", score:-2, msg:"Óleos contaminam gravemente o curso d'água."},
    {t:"Registro e aviso autoridade/serviço ambiental", type:"env", score:2, msg:"Notificar ajuda intervenção rápida."},
    {t:"Tento conter com materiais absorventes (se seguro)", type:"env", score:1, msg:"Apenas se seguro — conter pode diminuir dano."}
  ]},
  {q:"Vê comércio despejando restos de comida diretamente na rua (que vai ao bueiro). Você…", opts:[
    {t:"Não me envolvo", type:"env", score:-1, msg:"Restos bloqueiam drenagem e seguem ao rio."},
    {t:"Converso com o comerciante sobre descarte correto", type:"env", score:2, msg:"Explicar alternativas ajuda a reduzir poluição."},
    {t:"Registro e denuncio para fiscalização sanitária", type:"env", score:1, msg:"Fiscalização é importante para mudar práticas."}
  ]},
  {q:"Você encontra rede/objetos de pesca presos em galhos no rio. O que faz?", opts:[
    {t:"Deixo — é perigoso mexer", type:"env", score:-1, msg:"Resíduos continuam ferindo animais."},
    {t:"Falo com grupo local de proteção animal para remover", type:"env", score:2, msg:"Acionar especialistas é correto e seguro."},
    {t:"Anoto localização e informo autoridades ambientais", type:"env", score:1, msg:"Informar facilita remoção segura."}
  ]},
  {q:"Vê espuma ou coloração estranha na água do córrego. Você…", opts:[
    {t:"Acho normal e sigo", type:"env", score:-1, msg:"Sinais de poluição devem ser reportados."},
    {t:"Registro e envio para órgãos ambientais", type:"env", score:2, msg:"Reportar ajuda a detectar poluição."},
    {t:"Aviso vizinhos e peço cuidado com fontes suspeitas", type:"resp", score:1, msg:"Avisar aumenta vigilância comunitária."}
  ]},
  {q:"Durante limpeza comunitária, encontra vidro quebrado perto do rio. Você…", opts:[
    {t:"Não recolho por medo de me cortar", type:"env", score:-1, msg:"Vidros machucam fauna e pessoas."},
    {t:"Recolho com luvas e descarte seguro", type:"env", score:2, msg:"Recolher com segurança protege todos."},
    {t:"Indico local para coleta por equipe especializada", type:"env", score:1, msg:"Equipe especializada é ideal para resíduos perigosos."}
  ]},
  {q:"Vê plástico micro preso em plantas aquáticas. Você…", opts:[
    {t:"Ignoro — é difícil remover", type:"env", score:-1, msg:"Microplásticos prejudicam o ecossistema."},
    {t:"Recolho cuidadosamente o material visível", type:"env", score:2, msg:"Remover plásticos protege vida aquática."},
    {t:"Tiro foto e registro para iniciativa de pesquisa", type:"resp", score:1, msg:"Dados ajudam estudos sobre poluição."}
  ]},
  {q:"Seu transporte público tem lixo na área do embarque. Você…", opts:[
    {t:"Jogo meu lixo no chão também", type:"env", score:-1, msg:"Contribuir aumenta sujeira urbana."},
    {t:"Levo meu lixo até a lixeira e incentivo outros", type:"env", score:2, msg:"Exemplo influencia comportamento."},
    {t:"Registro e peço recolhimento ao responsável", type:"resp", score:1, msg:"Relatar ajuda na limpeza do local."}
  ]},
  {q:"Sabe de ponto que frequentemente tem descarte ilegal de lixo. Você…", opts:[
    {t:"Ignoro — já é comum", type:"env", score:-1, msg:"Aceitar normaliza o problema."},
    {t:"Organizo denúncia coletiva e ação de limpeza", type:"env", score:2, msg:"Ação coletiva costuma resolver."},
    {t:"Coloco placas informativas e lixeiras comunitárias", type:"resp", score:1, msg:"Prevenção local reduz descarte."}
  ]},
  {q:"Alguém oferece trocar lixo por dinheiro perto do rio. Você…", opts:[
    {t:"Aceito por facilidade", type:"env", score:-1, msg:"Lixo mal gerenciado pode voltar ao rio."},
    {t:"Recuso e busco destinação correta", type:"env", score:2, msg:"Recusar práticas ruins ajuda longamente."},
    {t:"Informo sobre canais oficiais de reciclagem", type:"resp", score:1, msg:"Educar sobre alternativas é útil."}
  ]},
  {q:"Última pergunta: você quer se comprometer a pelo menos uma ação para proteger rios (ex.: carregar lixo, denunciar, participar de mutirão)?", opts:[
    {t:"Não vou me comprometer", type:"resp", score:-1, msg:"Sem compromisso, mudanças demoram a acontecer."},
    {t:"Sim — escolho ao menos uma ação e começo hoje", type:"resp", score:3, msg:"Excelente! Pequenas ações podem gerar grande impacto."},
    {t:"Vou começar compartilhando e incentivando amigos", type:"resp", score:2, msg:"Divulgar cria efeito multiplicador."}
  ]}
];

/* ====== UI & Flow ====== */
const questionDiv = document.getElementById('question');
const choicesDiv = document.getElementById('choices');
const scoreBoard = document.getElementById('scoreBoard');
const remainingDiv = document.getElementById('remaining');
const currentSceneDiv = document.getElementById('currentScene');
const scoreBreak = document.getElementById('scoreBreak');
const xEffect = document.getElementById('xEffect');

function shuffleCopy(arr){
  const copy = arr.slice();
  for(let i=copy.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [copy[i], copy[j]] = [copy[j], copy[i]];
  }
  return copy;
}

function updateMeta(){
  const total = scores.env + scores.eth + scores.resp;
  scoreBoard.innerText = `Pontuação: ${total}`;
  remainingDiv.innerText = `Questões restantes: ${questions.length - sceneIndex}`;
  currentSceneDiv.innerText = `Questão: ${Math.min(sceneIndex+1, questions.length)} / ${questions.length}`;
  scoreBreak.innerText = `Ambiental: ${scores.env}  •  Ética: ${scores.eth}  •  Responsab.: ${scores.resp}`;
}

function resetGame(){
  sceneIndex = 0;
  scores = {env:0,eth:0,resp:0};
  updateMeta();
}

/* show scene */
function showScene(){
  if(sceneIndex >= questions.length){
    // fim
    questionDiv.innerText = `Fim do jogo! Pontuação final: ${scores.env + scores.eth + scores.resp}`;
    choicesDiv.innerHTML = `<button class="btn" onclick="restartGame()">Jogar novamente</button>`;
    remainingDiv.innerText = `Questões restantes: 0`;
    currentSceneDiv.innerText = `Questão: ${questions.length} / ${questions.length}`;
    return;
  }
  const q = questions[sceneIndex];
  questionDiv.innerText = q.q;
  choicesDiv.innerHTML = '';
  // shuffle choices for display
  const shuffled = shuffleCopy(q.opts);
  shuffled.forEach(opt=>{
    const b = document.createElement('button');
    b.className = 'btn'; // leave all buttons visually normal
    b.innerText = opt.t;
    b.onclick = () => handleChoice(opt);
    choicesDiv.appendChild(b);
  });
  updateMeta();
}

/* handle choice selection */
function handleChoice(opt){
  // normalize score: >0 => +1, 0 => 0, <0 => -1
  const normalized = opt.score > 0 ? 1 : (opt.score < 0 ? -1 : 0);

  if(normalized > 0){
    // fireworks in random center area
    const rect = game.getBoundingClientRect();
    const x = (rect.width * (0.45 + Math.random()*0.1));
    const y = (rect.height * (0.28 + Math.random()*0.08));
    const c = randomColorRGB();
    spawnFireworks(x,y,c);
    playCorrectSound();
  } else if(normalized < 0){
    xEffect.innerText = '❌';
    xEffect.style.color = 'var(--bad)';
    xEffect.style.display = 'block';
    playWrongSound();
    setTimeout(()=>{ xEffect.style.display = 'none'; }, 900);
  } else {
    // neutral (meia-certa)
    xEffect.innerText = '👌';
    xEffect.style.color = 'var(--neutral)';
    xEffect.style.display = 'block';
    playNeutralSound();
    setTimeout(()=>{ xEffect.style.display = 'none'; }, 700);
  }

  // update scores by type using normalized value
  if(opt.type === 'env') scores.env += normalized;
  if(opt.type === 'eth') scores.eth += normalized;
  if(opt.type === 'resp') scores.resp += normalized;

  // show message and continue button
  questionDiv.innerText = opt.msg;
  choicesDiv.innerHTML = `<button id="continue" class="btn" onclick="nextQ()">Continuar</button>`;
  updateMeta();
}

/* go next */
function nextQ(){
  sceneIndex++;
  showScene();
}

/* start / restart helpers */
function start(){
  // activate audio context on user gesture
  ensureAudio();
  resetGame();
  showScene();
}
function restartGame(){ start(); }

/* wire start button */
document.getElementById('startBtn').addEventListener('click', ()=>{
  start();
});

/* Initial meta */
updateMeta();

</script>
</body>
</html>
